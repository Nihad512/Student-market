{"ast":null,"code":"import _defineProperty from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Asus\\\\Desktop\\\\house-marketing-main\\\\src\\\\pages\\\\CreateListing.jsx\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect, useRef } from 'react';\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\nimport { db } from '../firebase.config';\nimport { useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { v4 as uuidv4 } from 'uuid';\nimport Spinner from '../components/Spinner';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction CreateListing() {\n  _s();\n\n  // eslint-disable-next-line\n  var _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      geolocationEnabled = _useState2[0],\n      setGeolocationEnabled = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useState5 = useState({\n    type: 'rent',\n    name: '',\n    description: '',\n    address: '',\n    offer: false,\n    regularPrice: 0,\n    discountedPrice: 0,\n    images: {},\n    latitude: 0,\n    longitude: 0\n  }),\n      _useState6 = _slicedToArray(_useState5, 2),\n      formData = _useState6[0],\n      setFormData = _useState6[1];\n\n  var type = formData.type,\n      name = formData.name,\n      description = formData.description,\n      address = formData.address,\n      offer = formData.offer,\n      regularPrice = formData.regularPrice,\n      discountedPrice = formData.discountedPrice,\n      images = formData.images,\n      latitude = formData.latitude,\n      longitude = formData.longitude;\n  var auth = getAuth();\n  var navigate = useNavigate();\n  var isMounted = useRef(true);\n  useEffect(function () {\n    if (isMounted) {\n      onAuthStateChanged(auth, function (user) {\n        if (user) {\n          setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n            userRef: user.uid\n          }));\n        } else {\n          navigate('/sign-in');\n        }\n      });\n    }\n\n    return function () {\n      isMounted.current = false;\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isMounted]);\n\n  var onSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      var geolocation, location, REACT_APP_GEOCODE_API_KEY, _data$results$0$geome, _data$results$, _data$results$0$geome2, _data$results$2, _data$results$3, response, data, storeImage, imgUrls, formDataCopy, docRef;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n              setLoading(true);\n\n              if (!(discountedPrice >= regularPrice)) {\n                _context2.next = 6;\n                break;\n              }\n\n              setLoading(false);\n              toast.error('Discounted price needs to be less than regular price');\n              return _context2.abrupt(\"return\");\n\n            case 6:\n              if (!(images.length > 6)) {\n                _context2.next = 10;\n                break;\n              }\n\n              setLoading(false);\n              toast.error('Max 6 images');\n              return _context2.abrupt(\"return\");\n\n            case 10:\n              geolocation = {};\n              REACT_APP_GEOCODE_API_KEY = 'AIzaSyC_mnmV8bSDh0YhMMQMBHLKS667q4S86hw';\n\n              if (!geolocationEnabled) {\n                _context2.next = 28;\n                break;\n              }\n\n              _context2.next = 15;\n              return fetch(\"https://maps.googleapis.com/maps/api/geocode/json?address=\".concat(address, \"&key=\").concat(REACT_APP_GEOCODE_API_KEY));\n\n            case 15:\n              response = _context2.sent;\n              _context2.next = 18;\n              return response.json();\n\n            case 18:\n              data = _context2.sent;\n              geolocation.lat = (_data$results$0$geome = (_data$results$ = data.results[0]) === null || _data$results$ === void 0 ? void 0 : _data$results$.geometry.location.lat) !== null && _data$results$0$geome !== void 0 ? _data$results$0$geome : 0;\n              geolocation.lng = (_data$results$0$geome2 = (_data$results$2 = data.results[0]) === null || _data$results$2 === void 0 ? void 0 : _data$results$2.geometry.location.lng) !== null && _data$results$0$geome2 !== void 0 ? _data$results$0$geome2 : 0;\n              location = data.status === 'ZERO_RESULTS' ? undefined : (_data$results$3 = data.results[0]) === null || _data$results$3 === void 0 ? void 0 : _data$results$3.formatted_address;\n\n              if (!(location === undefined || location.includes('undefined'))) {\n                _context2.next = 26;\n                break;\n              }\n\n              setLoading(false);\n              toast.error('Please enter a correct address');\n              return _context2.abrupt(\"return\");\n\n            case 26:\n              _context2.next = 30;\n              break;\n\n            case 28:\n              geolocation.lat = latitude;\n              geolocation.lng = longitude;\n\n            case 30:\n              // Store image in firebase\n              storeImage = /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(image) {\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n                            var storage = getStorage();\n                            var fileName = \"\".concat(auth.currentUser.uid, \"-\").concat(image.name, \"-\").concat(uuidv4());\n                            var storageRef = ref(storage, 'images/' + fileName);\n                            var uploadTask = uploadBytesResumable(storageRef, image);\n                            uploadTask.on('state_changed', function (snapshot) {\n                              var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n                              console.log('Upload is ' + progress + '% done');\n\n                              switch (snapshot.state) {\n                                case 'paused':\n                                  console.log('Upload is paused');\n                                  break;\n\n                                case 'running':\n                                  console.log('Upload is running');\n                                  break;\n\n                                default:\n                                  break;\n                              }\n                            }, function (error) {\n                              reject(error);\n                            }, function () {\n                              // Handle successful uploads on complete\n                              // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n                              getDownloadURL(uploadTask.snapshot.ref).then(function (downloadURL) {\n                                resolve(downloadURL);\n                              });\n                            });\n                          }));\n\n                        case 1:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function storeImage(_x2) {\n                  return _ref2.apply(this, arguments);\n                };\n              }();\n\n              _context2.next = 33;\n              return Promise.all(_toConsumableArray(images).map(function (image) {\n                return storeImage(image);\n              })).catch(function () {\n                setLoading(false);\n                toast.error('Images not uploaded');\n                return;\n              });\n\n            case 33:\n              imgUrls = _context2.sent;\n              formDataCopy = _objectSpread(_objectSpread({}, formData), {}, {\n                imgUrls: imgUrls,\n                geolocation: geolocation,\n                timestamp: serverTimestamp()\n              });\n              formDataCopy.location = address;\n              delete formDataCopy.images;\n              delete formDataCopy.address;\n              !formDataCopy.offer && delete formDataCopy.discountedPrice;\n              _context2.next = 41;\n              return addDoc(collection(db, 'listings'), formDataCopy);\n\n            case 41:\n              docRef = _context2.sent;\n              setLoading(false);\n              toast.success('Listing saved');\n              navigate(\"/category/\".concat(formDataCopy.type, \"/\").concat(docRef.id));\n\n            case 45:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var onMutate = function onMutate(e) {\n    var boolean = null;\n\n    if (e.target.value === 'true') {\n      boolean = true;\n    }\n\n    if (e.target.value === 'false') {\n      boolean = false;\n    } // Files\n\n\n    if (e.target.files) {\n      setFormData(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          images: e.target.files\n        });\n      });\n    } // Text/Booleans/Numbers\n\n\n    if (!e.target.files) {\n      setFormData(function (prevState) {\n        var _boolean;\n\n        return _objectSpread(_objectSpread({}, prevState), {}, _defineProperty({}, e.target.id, (_boolean = boolean) !== null && _boolean !== void 0 ? _boolean : e.target.value));\n      });\n    }\n  };\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 12\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"profile\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"pageHeader\",\n        children: \"Create a Listing\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: onSubmit,\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Sell / Rent\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formButtons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: type === 'sale' ? 'formButtonActive' : 'formButton',\n            id: \"type\",\n            value: \"sale\",\n            onClick: onMutate,\n            children: \"Sell\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: type === 'rent' ? 'formButtonActive' : 'formButton',\n            id: \"type\",\n            value: \"rent\",\n            onClick: onMutate,\n            children: \"Rent\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"formInputName\",\n          type: \"text\",\n          id: \"name\",\n          value: name,\n          onChange: onMutate,\n          maxLength: \"32\",\n          minLength: \"10\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Description\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"formInputName\",\n          type: \"text\",\n          id: \"description\",\n          value: description,\n          onChange: onMutate,\n          maxLength: \"32\",\n          minLength: \"10\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Address\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: \"formInputAddress\",\n          type: \"text\",\n          id: \"address\",\n          value: address,\n          onChange: onMutate,\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 11\n        }, this), !geolocationEnabled && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formLatLng flex\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"formLabel\",\n              children: \"Latitude\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 278,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"formInputSmall\",\n              type: \"number\",\n              id: \"latitude\",\n              value: latitude,\n              onChange: onMutate,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 279,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"formLabel\",\n              children: \"Longitude\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"formInputSmall\",\n              type: \"number\",\n              id: \"longitude\",\n              value: longitude,\n              onChange: onMutate,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 290,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Offer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formButtons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: offer ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"offer\",\n            value: true,\n            onClick: onMutate,\n            children: \"Yes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: !offer && offer !== null ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"offer\",\n            value: false,\n            onClick: onMutate,\n            children: \"No\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Regular Price\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formPriceDiv\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"formInputSmall\",\n            type: \"number\",\n            id: \"regularPrice\",\n            value: regularPrice,\n            onChange: onMutate,\n            min: \"50\",\n            max: \"750000000\",\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 13\n          }, this), type === 'rent' && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"formPriceText\",\n            children: \"$ / Month\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 338,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 11\n        }, this), offer && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"formLabel\",\n            children: \"Discounted Price\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 343,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"formInputSmall\",\n            type: \"number\",\n            id: \"discountedPrice\",\n            value: discountedPrice,\n            onChange: onMutate,\n            min: \"50\",\n            max: \"750000000\",\n            required: offer\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 344,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Images\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"imagesInfo\",\n          children: \"The first image will be the cover (max 6).\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"formInputFile\",\n          type: \"file\",\n          id: \"images\",\n          onChange: onMutate,\n          max: \"6\",\n          accept: \".jpg,.png,.jpeg\",\n          multiple: true,\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"primaryButton createListingButton\",\n          children: \"Create Listing\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 211,\n    columnNumber: 5\n  }, this);\n}\n\n_s(CreateListing, \"79bv0cGHSdwd5ogeAzHaW322gJQ=\", false, function () {\n  return [useNavigate];\n});\n\n_c = CreateListing;\nexport default CreateListing;\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateListing\");","map":{"version":3,"sources":["C:/Users/Asus/Desktop/house-marketing-main/src/pages/CreateListing.jsx"],"names":["useState","useEffect","useRef","getAuth","onAuthStateChanged","getStorage","ref","uploadBytesResumable","getDownloadURL","addDoc","collection","serverTimestamp","db","useNavigate","toast","v4","uuidv4","Spinner","CreateListing","geolocationEnabled","setGeolocationEnabled","loading","setLoading","type","name","description","address","offer","regularPrice","discountedPrice","images","latitude","longitude","formData","setFormData","auth","navigate","isMounted","user","userRef","uid","current","onSubmit","e","preventDefault","error","length","geolocation","REACT_APP_GEOCODE_API_KEY","fetch","response","json","data","lat","results","geometry","location","lng","status","undefined","formatted_address","includes","storeImage","image","Promise","resolve","reject","storage","fileName","currentUser","storageRef","uploadTask","on","snapshot","progress","bytesTransferred","totalBytes","console","log","state","then","downloadURL","all","map","catch","imgUrls","formDataCopy","timestamp","docRef","success","id","onMutate","boolean","target","value","files","prevState"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef } from 'react'\nimport { getAuth, onAuthStateChanged } from 'firebase/auth'\nimport {\n  getStorage,\n  ref,\n  uploadBytesResumable,\n  getDownloadURL,\n} from 'firebase/storage'\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore'\nimport { db } from '../firebase.config'\nimport { useNavigate } from 'react-router-dom'\nimport { toast } from 'react-toastify'\nimport { v4 as uuidv4 } from 'uuid'\nimport Spinner from '../components/Spinner'\n\nfunction CreateListing() {\n  // eslint-disable-next-line\n  const [geolocationEnabled, setGeolocationEnabled] = useState(true)\n  const [loading, setLoading] = useState(false)\n  const [formData, setFormData] = useState({\n    type: 'rent',\n    name: '',\n    description:'',\n    address: '',\n    offer: false,\n    regularPrice: 0,\n    discountedPrice: 0,\n    images: {},\n    latitude: 0,\n    longitude: 0,\n  })\n\n  const {\n    type,\n    name,\n    description,\n    address,\n    offer,\n    regularPrice,\n    discountedPrice,\n    images,\n    latitude,\n    longitude,\n  } = formData\n\n  const auth = getAuth()\n  const navigate = useNavigate()\n  const isMounted = useRef(true)\n\n  useEffect(() => {\n    if (isMounted) {\n      onAuthStateChanged(auth, (user) => {\n        if (user) {\n          setFormData({ ...formData, userRef: user.uid })\n        } else {\n          navigate('/sign-in')\n        }\n      })\n    }\n\n    return () => {\n      isMounted.current = false\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isMounted])\n\n  const onSubmit = async (e) => {\n    e.preventDefault()\n\n    setLoading(true)\n\n    if (discountedPrice >= regularPrice) {\n      setLoading(false)\n      toast.error('Discounted price needs to be less than regular price')\n      return\n    }\n\n    if (images.length > 6) {\n      setLoading(false)\n      toast.error('Max 6 images')\n      return\n    }\n\n    let geolocation = {}\n    let location\n    let REACT_APP_GEOCODE_API_KEY='AIzaSyC_mnmV8bSDh0YhMMQMBHLKS667q4S86hw'\n    if (geolocationEnabled) {\n      const response = await fetch(\n        `https://maps.googleapis.com/maps/api/geocode/json?address=${address}&key=${REACT_APP_GEOCODE_API_KEY}`\n      )\n\n      const data = await response.json()\n\n      geolocation.lat = data.results[0]?.geometry.location.lat ?? 0\n      geolocation.lng = data.results[0]?.geometry.location.lng ?? 0\n\n      location =\n        data.status === 'ZERO_RESULTS'\n          ? undefined\n          : data.results[0]?.formatted_address\n\n      if (location === undefined || location.includes('undefined')) {\n        setLoading(false)\n        toast.error('Please enter a correct address')\n        return\n      }\n    } else {\n      geolocation.lat = latitude\n      geolocation.lng = longitude\n    }\n\n    // Store image in firebase\n    const storeImage = async (image) => {\n      return new Promise((resolve, reject) => {\n        const storage = getStorage()\n        const fileName = `${auth.currentUser.uid}-${image.name}-${uuidv4()}`\n\n        const storageRef = ref(storage, 'images/' + fileName)\n\n        const uploadTask = uploadBytesResumable(storageRef, image)\n\n        uploadTask.on(\n          'state_changed',\n          (snapshot) => {\n            const progress =\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n            console.log('Upload is ' + progress + '% done')\n            switch (snapshot.state) {\n              case 'paused':\n                console.log('Upload is paused')\n                break\n              case 'running':\n                console.log('Upload is running')\n                break\n              default:\n                break\n            }\n          },\n          (error) => {\n            reject(error)\n          },\n          () => {\n            // Handle successful uploads on complete\n            // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n            getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\n              resolve(downloadURL)\n            })\n          }\n        )\n      })\n    }\n\n    const imgUrls = await Promise.all(\n      [...images].map((image) => storeImage(image))\n    ).catch(() => {\n      setLoading(false)\n      toast.error('Images not uploaded')\n      return\n    })\n\n    const formDataCopy = {\n      ...formData,\n      imgUrls,\n      geolocation,\n      timestamp: serverTimestamp(),\n    }\n\n    formDataCopy.location = address\n    delete formDataCopy.images\n    delete formDataCopy.address\n    !formDataCopy.offer && delete formDataCopy.discountedPrice\n\n    const docRef = await addDoc(collection(db, 'listings'), formDataCopy)\n    setLoading(false)\n    toast.success('Listing saved')\n    navigate(`/category/${formDataCopy.type}/${docRef.id}`)\n  }\n\n  const onMutate = (e) => {\n    let boolean = null\n\n    if (e.target.value === 'true') {\n      boolean = true\n    }\n    if (e.target.value === 'false') {\n      boolean = false\n    }\n\n    // Files\n    if (e.target.files) {\n      setFormData((prevState) => ({\n        ...prevState,\n        images: e.target.files,\n      }))\n    }\n\n    // Text/Booleans/Numbers\n    if (!e.target.files) {\n      setFormData((prevState) => ({\n        ...prevState,\n        [e.target.id]: boolean ?? e.target.value,\n      }))\n    }\n  }\n\n  if (loading) {\n    return <Spinner />\n  }\n\n  return (\n    <div className='profile'>\n      <header>\n        <p className='pageHeader'>Create a Listing</p>\n      </header>\n\n      <main>\n        <form onSubmit={onSubmit}>\n          <label className='formLabel'>Sell / Rent</label>\n          <div className='formButtons'>\n            <button\n              type='button'\n              className={type === 'sale' ? 'formButtonActive' : 'formButton'}\n              id='type'\n              value='sale'\n              onClick={onMutate}\n            >\n              Sell\n            </button>\n            <button\n              type='button'\n              className={type === 'rent' ? 'formButtonActive' : 'formButton'}\n              id='type'\n              value='rent'\n              onClick={onMutate}\n            >\n              Rent\n            </button>\n          </div>\n\n          <label className='formLabel'>Name</label>\n          <input\n            className='formInputName'\n            type='text'\n            id='name'\n            value={name}\n            onChange={onMutate}\n            maxLength='32'\n            minLength='10'\n            required\n          />\n          <label className='formLabel'>Description</label>\n          <input\n            className='formInputName'\n            type='text'\n            id='description'\n            value={description}\n            onChange={onMutate}\n            maxLength='32'\n            minLength='10'\n            required\n          />\n\n         \n\n          <label className='formLabel'>Address</label>\n          <textarea\n            className='formInputAddress'\n            type='text'\n            id='address'\n            value={address}\n            onChange={onMutate}\n            required\n          />\n\n          {!geolocationEnabled && (\n            <div className='formLatLng flex'>\n              <div>\n                <label className='formLabel'>Latitude</label>\n                <input\n                  className='formInputSmall'\n                  type='number'\n                  id='latitude'\n                  value={latitude}\n                  onChange={onMutate}\n                  required\n                />\n              </div>\n              <div>\n                <label className='formLabel'>Longitude</label>\n                <input\n                  className='formInputSmall'\n                  type='number'\n                  id='longitude'\n                  value={longitude}\n                  onChange={onMutate}\n                  required\n                />\n              </div>\n            </div>\n          )}\n\n          <label className='formLabel'>Offer</label>\n          <div className='formButtons'>\n            <button\n              className={offer ? 'formButtonActive' : 'formButton'}\n              type='button'\n              id='offer'\n              value={true}\n              onClick={onMutate}\n            >\n              Yes\n            </button>\n            <button\n              className={\n                !offer && offer !== null ? 'formButtonActive' : 'formButton'\n              }\n              type='button'\n              id='offer'\n              value={false}\n              onClick={onMutate}\n            >\n              No\n            </button>\n          </div>\n\n          <label className='formLabel'>Regular Price</label>\n          <div className='formPriceDiv'>\n            <input\n              className='formInputSmall'\n              type='number'\n              id='regularPrice'\n              value={regularPrice}\n              onChange={onMutate}\n              min='50'\n              max='750000000'\n              required\n            />\n            {type === 'rent' && <p className='formPriceText'>$ / Month</p>}\n          </div>\n\n          {offer && (\n            <>\n              <label className='formLabel'>Discounted Price</label>\n              <input\n                className='formInputSmall'\n                type='number'\n                id='discountedPrice'\n                value={discountedPrice}\n                onChange={onMutate}\n                min='50'\n                max='750000000'\n                required={offer}\n              />\n            </>\n          )}\n\n          <label className='formLabel'>Images</label>\n          <p className='imagesInfo'>\n            The first image will be the cover (max 6).\n          </p>\n          <input\n            className='formInputFile'\n            type='file'\n            id='images'\n            onChange={onMutate}\n            max='6'\n            accept='.jpg,.png,.jpeg'\n            multiple\n            required\n          />\n          <button type='submit' className='primaryButton createListingButton'>\n            Create Listing\n          </button>\n        </form>\n      </main>\n    </div>\n  )\n}\n\nexport default CreateListing\n"]},"metadata":{},"sourceType":"module"}