{"ast":null,"code":"import _defineProperty from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Asus\\\\Desktop\\\\house-marketing-main\\\\src\\\\pages\\\\Profile.jsx\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { getAuth, updateProfile } from 'firebase/auth';\nimport { updateDoc, doc, collection, getDocs, query, where, orderBy, deleteDoc } from 'firebase/firestore';\nimport { db } from '../firebase.config';\nimport { useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport ListingItem from '../components/ListingItem';\nimport arrowRight from \"../assets/svg/keyboardArrowRightIcon.svg\";\nimport homeIcon from \"../assets/svg/homeIcon.svg\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Profile() {\n  _s();\n\n  var _this = this;\n\n  var auth = getAuth();\n\n  var _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      listings = _useState4[0],\n      setListings = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      changeDetails = _useState6[0],\n      setChangeDetails = _useState6[1];\n\n  var _useState7 = useState({\n    name: auth.currentUser.displayName,\n    email: auth.currentUser.email\n  }),\n      _useState8 = _slicedToArray(_useState7, 2),\n      formData = _useState8[0],\n      setFormData = _useState8[1];\n\n  var name = formData.name,\n      email = formData.email;\n  var navigate = useNavigate();\n  useEffect(function () {\n    var fetchUserListings = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var listingsRef, q, querySnap, listings;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                listingsRef = collection(db, 'listings');\n                q = query(listingsRef, where('userRef', '==', auth.currentUser.uid), orderBy('timestamp', 'desc'));\n                _context.next = 4;\n                return getDocs(q);\n\n              case 4:\n                querySnap = _context.sent;\n                listings = [];\n                querySnap.forEach(function (doc) {\n                  return listings.push({\n                    id: doc.id,\n                    data: doc.data()\n                  });\n                });\n                setListings(listings);\n                setLoading(false);\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function fetchUserListings() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    fetchUserListings();\n  }, [auth.currentUser.uid]);\n\n  var onLogout = function onLogout() {\n    auth.signOut();\n    navigate('/');\n  };\n\n  var onSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var userRef;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n\n              if (!(auth.currentUser.displayName !== name)) {\n                _context2.next = 7;\n                break;\n              }\n\n              _context2.next = 4;\n              return updateProfile(auth.currentUser, {\n                displayName: name\n              });\n\n            case 4:\n              // Update in firestore\n              userRef = doc(db, 'users', auth.currentUser.uid);\n              _context2.next = 7;\n              return updateDoc(userRef, {\n                name: name\n              });\n\n            case 7:\n              _context2.next = 13;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0);\n              toast.error('Could not update profile details');\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 9]]);\n    }));\n\n    return function onSubmit() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onChange = function onChange(e) {\n    setFormData(function (prevState) {\n      return _objectSpread(_objectSpread({}, prevState), {}, _defineProperty({}, e.target.id, e.target.value));\n    });\n  };\n\n  var _onDelete = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(listingId) {\n      var updatedListings;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!window.confirm('Are you sure you want to delete?')) {\n                _context3.next = 6;\n                break;\n              }\n\n              _context3.next = 3;\n              return deleteDoc(doc(db, 'listings', listingId));\n\n            case 3:\n              updatedListings = listings.filter(function (listing) {\n                return listing.id !== listingId;\n              });\n              setListings(updatedListings);\n              toast.success('Successfully deleted listing');\n\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onDelete(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var _onEdit = function onEdit(listingId) {\n    return navigate(\"/edit-listing/\".concat(listingId));\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"profile\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"profileHeader\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"pageHeader\",\n        children: \"My Profile\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: \"logOut\",\n        onClick: onLogout,\n        children: \"Logout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"profileDetailsHeader\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"profileDetailsText\",\n          children: \"Personal Details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"changePersonalDetails\",\n          onClick: function onClick() {\n            changeDetails && onSubmit();\n            setChangeDetails(function (prevState) {\n              return !prevState;\n            });\n          },\n          children: changeDetails ? 'done' : 'change'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"profileCard\",\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            id: \"name\",\n            className: !changeDetails ? 'profileName' : 'profileNameActive',\n            disabled: !changeDetails,\n            value: name,\n            onChange: onChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            id: \"email\",\n            className: !changeDetails ? 'profileEmail' : 'profileEmailActive',\n            disabled: !changeDetails,\n            value: email,\n            onChange: onChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/create-listing\",\n        className: \"createListing\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: homeIcon,\n          alt: \"home\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Sell or rent your home\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: arrowRight,\n          alt: \"arrow right\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 9\n      }, this), !loading && (listings === null || listings === void 0 ? void 0 : listings.length) > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"listingText\",\n          children: \"Your Listings\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"listingsList\",\n          children: listings.map(function (listing) {\n            return /*#__PURE__*/_jsxDEV(ListingItem, {\n              listing: listing.data,\n              id: listing.id,\n              onDelete: function onDelete() {\n                return _onDelete(listing.id);\n              },\n              onEdit: function onEdit() {\n                return _onEdit(listing.id);\n              }\n            }, listing.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 163,\n              columnNumber: 17\n            }, _this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Profile, \"k+DKnnMPi/EoaFSWpKidkvQQs7M=\", false, function () {\n  return [useNavigate];\n});\n\n_c = Profile;\nexport default Profile;\n\nvar _c;\n\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"sources":["C:/Users/Asus/Desktop/house-marketing-main/src/pages/Profile.jsx"],"names":["useState","useEffect","Link","getAuth","updateProfile","updateDoc","doc","collection","getDocs","query","where","orderBy","deleteDoc","db","useNavigate","toast","ListingItem","Profile","auth","loading","setLoading","listings","setListings","changeDetails","setChangeDetails","name","currentUser","displayName","email","formData","setFormData","navigate","fetchUserListings","listingsRef","q","uid","querySnap","forEach","push","id","data","onLogout","signOut","onSubmit","userRef","console","log","error","onChange","e","prevState","target","value","onDelete","listingId","window","confirm","updatedListings","filter","listing","success","onEdit","homeIcon","arrowRight","length","map"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { Link } from 'react-router-dom'\nimport { getAuth, updateProfile } from 'firebase/auth'\nimport {\n  updateDoc,\n  doc,\n  collection,\n  getDocs,\n  query,\n  where,\n  orderBy,\n  deleteDoc,\n} from 'firebase/firestore'\nimport { db } from '../firebase.config'\nimport { useNavigate } from 'react-router-dom'\nimport { toast } from 'react-toastify'\nimport ListingItem from '../components/ListingItem'\nimport arrowRight from '../assets/svg/keyboardArrowRightIcon.svg'\nimport homeIcon from '../assets/svg/homeIcon.svg'\n\nfunction Profile() {\n  const auth = getAuth()\n  const [loading, setLoading] = useState(true)\n  const [listings, setListings] = useState(null)\n  const [changeDetails, setChangeDetails] = useState(false)\n  const [formData, setFormData] = useState({\n    name: auth.currentUser.displayName,\n    email: auth.currentUser.email,\n  })\n\n  const { name, email } = formData\n\n  const navigate = useNavigate()\n\n  useEffect(() => {\n    const fetchUserListings = async () => {\n      const listingsRef = collection(db, 'listings')\n\n      const q = query(\n        listingsRef,\n        where('userRef', '==', auth.currentUser.uid),\n        orderBy('timestamp', 'desc')\n      )\n\n      const querySnap = await getDocs(q)\n\n      let listings = []\n\n      querySnap.forEach((doc) => {\n        return listings.push({\n          id: doc.id,\n          data: doc.data(),\n        })\n      })\n\n      setListings(listings)\n      setLoading(false)\n    }\n\n    fetchUserListings()\n  }, [auth.currentUser.uid])\n\n  const onLogout = () => {\n    auth.signOut()\n    navigate('/')\n  }\n\n  const onSubmit = async () => {\n    try {\n      if (auth.currentUser.displayName !== name) {\n        // Update display name in fb\n        await updateProfile(auth.currentUser, {\n          displayName: name,\n        })\n\n        // Update in firestore\n        const userRef = doc(db, 'users', auth.currentUser.uid)\n        await updateDoc(userRef, {\n          name,\n        })\n      }\n    } catch (error) {\n      console.log(error)\n      toast.error('Could not update profile details')\n    }\n  }\n\n  const onChange = (e) => {\n    setFormData((prevState) => ({\n      ...prevState,\n      [e.target.id]: e.target.value,\n    }))\n  }\n\n  const onDelete = async (listingId) => {\n    if (window.confirm('Are you sure you want to delete?')) {\n      await deleteDoc(doc(db, 'listings', listingId))\n      const updatedListings = listings.filter(\n        (listing) => listing.id !== listingId\n      )\n      setListings(updatedListings)\n      toast.success('Successfully deleted listing')\n    }\n  }\n\n  const onEdit = (listingId) => navigate(`/edit-listing/${listingId}`)\n\n  return (\n    <div className='profile'>\n      <header className='profileHeader'>\n        <p className='pageHeader'>My Profile</p>\n        <button type='button' className='logOut' onClick={onLogout}>\n          Logout\n        </button>\n      </header>\n\n      <main>\n        <div className='profileDetailsHeader'>\n          <p className='profileDetailsText'>Personal Details</p>\n          <p\n            className='changePersonalDetails'\n            onClick={() => {\n              changeDetails && onSubmit()\n              setChangeDetails((prevState) => !prevState)\n            }}\n          >\n            {changeDetails ? 'done' : 'change'}\n          </p>\n        </div>\n\n        <div className='profileCard'>\n          <form>\n            <input\n              type='text'\n              id='name'\n              className={!changeDetails ? 'profileName' : 'profileNameActive'}\n              disabled={!changeDetails}\n              value={name}\n              onChange={onChange}\n            />\n            <input\n              type='text'\n              id='email'\n              className={!changeDetails ? 'profileEmail' : 'profileEmailActive'}\n              disabled={!changeDetails}\n              value={email}\n              onChange={onChange}\n            />\n          </form>\n        </div>\n\n        <Link to='/create-listing' className='createListing'>\n          <img src={homeIcon} alt='home' />\n          <p>Sell or rent your home</p>\n          <img src={arrowRight} alt='arrow right' />\n        </Link>\n\n        {!loading && listings?.length > 0 && (\n          <>\n            <p className='listingText'>Your Listings</p>\n            <ul className='listingsList'>\n              {listings.map((listing) => (\n                <ListingItem\n                  key={listing.id}\n                  listing={listing.data}\n                  id={listing.id}\n                  onDelete={() => onDelete(listing.id)}\n                  onEdit={() => onEdit(listing.id)}\n                />\n              ))}\n            </ul>\n          </>\n        )}\n      </main>\n    </div>\n  )\n}\n\nexport default Profile\n"]},"metadata":{},"sourceType":"module"}