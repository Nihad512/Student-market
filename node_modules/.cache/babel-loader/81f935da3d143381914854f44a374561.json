{"ast":null,"code":"import _defineProperty from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/regenerator\";\nimport _objectSpread from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/Users/Asus/Desktop/house-marketing-main/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Asus\\\\Desktop\\\\house-marketing-main\\\\src\\\\pages\\\\EditListing.jsx\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect, useRef } from 'react';\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';\nimport { doc, updateDoc, getDoc, serverTimestamp } from 'firebase/firestore';\nimport { db } from '../firebase.config';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { v4 as uuidv4 } from 'uuid';\nimport Spinner from '../components/Spinner';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction EditListing() {\n  _s();\n\n  // eslint-disable-next-line\n  var _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      geolocationEnabled = _useState2[0],\n      setGeolocationEnabled = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      listing = _useState6[0],\n      setListing = _useState6[1];\n\n  var _useState7 = useState({\n    type: 'rent',\n    name: '',\n    description: '',\n    address: '',\n    offer: false,\n    regularPrice: 0,\n    discountedPrice: 0,\n    images: {},\n    latitude: 0,\n    longitude: 0\n  }),\n      _useState8 = _slicedToArray(_useState7, 2),\n      formData = _useState8[0],\n      setFormData = _useState8[1];\n\n  var type = formData.type,\n      name = formData.name,\n      description = formData.description,\n      address = formData.address,\n      offer = formData.offer,\n      regularPrice = formData.regularPrice,\n      discountedPrice = formData.discountedPrice,\n      images = formData.images,\n      latitude = formData.latitude,\n      longitude = formData.longitude;\n  var auth = getAuth();\n  var navigate = useNavigate();\n  var params = useParams();\n  var isMounted = useRef(true); // Redirect if listing is not user's\n\n  useEffect(function () {\n    if (listing && listing.userRef !== auth.currentUser.uid) {\n      toast.error('You can not edit that listing');\n      navigate('/');\n    }\n  }); // Fetch listing to edit\n\n  useEffect(function () {\n    setLoading(true);\n\n    var fetchListing = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var docRef, docSnap;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                docRef = doc(db, 'listings', params.listingId);\n                _context.next = 3;\n                return getDoc(docRef);\n\n              case 3:\n                docSnap = _context.sent;\n\n                if (docSnap.exists()) {\n                  setListing(docSnap.data());\n                  setFormData(_objectSpread(_objectSpread({}, docSnap.data()), {}, {\n                    address: docSnap.data().location\n                  }));\n                  setLoading(false);\n                } else {\n                  navigate('/');\n                  toast.error('Listing does not exist');\n                }\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function fetchListing() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    fetchListing();\n  }, [params.listingId, navigate]); // Sets userRef to logged in user\n\n  useEffect(function () {\n    if (isMounted) {\n      onAuthStateChanged(auth, function (user) {\n        if (user) {\n          setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n            userRef: user.uid\n          }));\n        } else {\n          navigate('/sign-in');\n        }\n      });\n    }\n\n    return function () {\n      isMounted.current = false;\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isMounted]);\n\n  var onSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e) {\n      var geolocation, location, REACT_APP_GEOCODE_API_KEY, _data$results$0$geome, _data$results$, _data$results$0$geome2, _data$results$2, _data$results$3, response, data, storeImage, imgUrls, formDataCopy, docRef;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              e.preventDefault();\n              setLoading(true);\n\n              if (!(discountedPrice >= regularPrice)) {\n                _context3.next = 6;\n                break;\n              }\n\n              setLoading(false);\n              toast.error('Discounted price needs to be less than regular price');\n              return _context3.abrupt(\"return\");\n\n            case 6:\n              if (!(images.length > 6)) {\n                _context3.next = 10;\n                break;\n              }\n\n              setLoading(false);\n              toast.error('Max 6 images');\n              return _context3.abrupt(\"return\");\n\n            case 10:\n              geolocation = {};\n              REACT_APP_GEOCODE_API_KEY = 'AIzaSyC_mnmV8bSDh0YhMMQMBHLKS667q4S86hw';\n\n              if (!geolocationEnabled) {\n                _context3.next = 28;\n                break;\n              }\n\n              _context3.next = 15;\n              return fetch(\"https://maps.googleapis.com/maps/api/geocode/json?address=\".concat(address, \"&key=\").concat(REACT_APP_GEOCODE_API_KEY));\n\n            case 15:\n              response = _context3.sent;\n              _context3.next = 18;\n              return response.json();\n\n            case 18:\n              data = _context3.sent;\n              geolocation.lat = (_data$results$0$geome = (_data$results$ = data.results[0]) === null || _data$results$ === void 0 ? void 0 : _data$results$.geometry.location.lat) !== null && _data$results$0$geome !== void 0 ? _data$results$0$geome : 0;\n              geolocation.lng = (_data$results$0$geome2 = (_data$results$2 = data.results[0]) === null || _data$results$2 === void 0 ? void 0 : _data$results$2.geometry.location.lng) !== null && _data$results$0$geome2 !== void 0 ? _data$results$0$geome2 : 0;\n              location = data.status === 'ZERO_RESULTS' ? undefined : (_data$results$3 = data.results[0]) === null || _data$results$3 === void 0 ? void 0 : _data$results$3.formatted_address;\n\n              if (!(location === undefined || location.includes('undefined'))) {\n                _context3.next = 26;\n                break;\n              }\n\n              setLoading(false);\n              toast.error('Please enter a correct address');\n              return _context3.abrupt(\"return\");\n\n            case 26:\n              _context3.next = 30;\n              break;\n\n            case 28:\n              geolocation.lat = latitude;\n              geolocation.lng = longitude;\n\n            case 30:\n              // Store image in firebase\n              storeImage = /*#__PURE__*/function () {\n                var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(image) {\n                  return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          return _context2.abrupt(\"return\", new Promise(function (resolve, reject) {\n                            var storage = getStorage();\n                            var fileName = \"\".concat(auth.currentUser.uid, \"-\").concat(image.name, \"-\").concat(uuidv4());\n                            var storageRef = ref(storage, 'images/' + fileName);\n                            var uploadTask = uploadBytesResumable(storageRef, image);\n                            uploadTask.on('state_changed', function (snapshot) {\n                              var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n                              console.log('Upload is ' + progress + '% done');\n\n                              switch (snapshot.state) {\n                                case 'paused':\n                                  console.log('Upload is paused');\n                                  break;\n\n                                case 'running':\n                                  console.log('Upload is running');\n                                  break;\n\n                                default:\n                                  break;\n                              }\n                            }, function (error) {\n                              reject(error);\n                            }, function () {\n                              // Handle successful uploads on complete\n                              // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n                              getDownloadURL(uploadTask.snapshot.ref).then(function (downloadURL) {\n                                resolve(downloadURL);\n                              });\n                            });\n                          }));\n\n                        case 1:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _callee2);\n                }));\n\n                return function storeImage(_x2) {\n                  return _ref3.apply(this, arguments);\n                };\n              }();\n\n              _context3.next = 33;\n              return Promise.all(_toConsumableArray(images).map(function (image) {\n                return storeImage(image);\n              })).catch(function () {\n                setLoading(false);\n                toast.error('Images not uploaded');\n                return;\n              });\n\n            case 33:\n              imgUrls = _context3.sent;\n              formDataCopy = _objectSpread(_objectSpread({}, formData), {}, {\n                imgUrls: imgUrls,\n                geolocation: geolocation,\n                timestamp: serverTimestamp()\n              });\n              formDataCopy.location = address;\n              delete formDataCopy.images;\n              delete formDataCopy.address;\n              !formDataCopy.offer && delete formDataCopy.discountedPrice; // Update listing\n\n              docRef = doc(db, 'listings', params.listingId);\n              _context3.next = 42;\n              return updateDoc(docRef, formDataCopy);\n\n            case 42:\n              setLoading(false);\n              toast.success('Listing saved');\n              navigate(\"/category/\".concat(formDataCopy.type, \"/\").concat(docRef.id));\n\n            case 45:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onMutate = function onMutate(e) {\n    var boolean = null;\n\n    if (e.target.value === 'true') {\n      boolean = true;\n    }\n\n    if (e.target.value === 'false') {\n      boolean = false;\n    } // Files\n\n\n    if (e.target.files) {\n      setFormData(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          images: e.target.files\n        });\n      });\n    } // Text/Booleans/Numbers\n\n\n    if (!e.target.files) {\n      setFormData(function (prevState) {\n        var _boolean;\n\n        return _objectSpread(_objectSpread({}, prevState), {}, _defineProperty({}, e.target.id, (_boolean = boolean) !== null && _boolean !== void 0 ? _boolean : e.target.value));\n      });\n    }\n  };\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 12\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"profile\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"pageHeader\",\n        children: \"Edit Listing\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: onSubmit,\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Sell / Rent\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formButtons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: type === 'sale' ? 'formButtonActive' : 'formButton',\n            id: \"type\",\n            value: \"sale\",\n            onClick: onMutate,\n            children: \"Sell\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: type === 'rent' ? 'formButtonActive' : 'formButton',\n            id: \"type\",\n            value: \"rent\",\n            onClick: onMutate,\n            children: \"Rent\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"formInputName\",\n          type: \"text\",\n          id: \"name\",\n          value: name,\n          onChange: onMutate,\n          maxLength: \"32\",\n          minLength: \"10\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Description\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"formInputName\",\n          type: \"text\",\n          id: \"description\",\n          value: description,\n          onChange: onMutate,\n          maxLength: \"32\",\n          minLength: \"10\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Address\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: \"formInputAddress\",\n          type: \"text\",\n          id: \"address\",\n          value: address,\n          onChange: onMutate,\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }, this), !geolocationEnabled && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formLatLng flex\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"formLabel\",\n              children: \"Latitude\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"formInputSmall\",\n              type: \"number\",\n              id: \"latitude\",\n              value: latitude,\n              onChange: onMutate,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 309,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"formLabel\",\n              children: \"Longitude\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"formInputSmall\",\n              type: \"number\",\n              id: \"longitude\",\n              value: longitude,\n              onChange: onMutate,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 318,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Offer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formButtons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: offer ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"offer\",\n            value: true,\n            onClick: onMutate,\n            children: \"Yes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: !offer && offer !== null ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"offer\",\n            value: false,\n            onClick: onMutate,\n            children: \"No\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 343,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Regular Price\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formPriceDiv\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"formInputSmall\",\n            type: \"number\",\n            id: \"regularPrice\",\n            value: regularPrice,\n            onChange: onMutate,\n            min: \"50\",\n            max: \"750000000\",\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 13\n          }, this), type === 'rent' && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"formPriceText\",\n            children: \"$ / Month\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 368,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 11\n        }, this), offer && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"formLabel\",\n            children: \"Discounted Price\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"formInputSmall\",\n            type: \"number\",\n            id: \"discountedPrice\",\n            value: discountedPrice,\n            onChange: onMutate,\n            min: \"50\",\n            max: \"750000000\",\n            required: offer\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Images\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"imagesInfo\",\n          children: \"The first image will be the cover (max 6).\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"formInputFile\",\n          type: \"file\",\n          id: \"images\",\n          onChange: onMutate,\n          max: \"6\",\n          accept: \".jpg,.png,.jpeg\",\n          multiple: true,\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 391,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"primaryButton createListingButton\",\n          children: \"Edit Listing\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 401,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 243,\n    columnNumber: 5\n  }, this);\n}\n\n_s(EditListing, \"m8gkknsUXRRr3jY4fk/iotuuCns=\", false, function () {\n  return [useNavigate, useParams];\n});\n\n_c = EditListing;\nexport default EditListing;\n\nvar _c;\n\n$RefreshReg$(_c, \"EditListing\");","map":{"version":3,"sources":["C:/Users/Asus/Desktop/house-marketing-main/src/pages/EditListing.jsx"],"names":["useState","useEffect","useRef","getAuth","onAuthStateChanged","getStorage","ref","uploadBytesResumable","getDownloadURL","doc","updateDoc","getDoc","serverTimestamp","db","useNavigate","useParams","toast","v4","uuidv4","Spinner","EditListing","geolocationEnabled","setGeolocationEnabled","loading","setLoading","listing","setListing","type","name","description","address","offer","regularPrice","discountedPrice","images","latitude","longitude","formData","setFormData","auth","navigate","params","isMounted","userRef","currentUser","uid","error","fetchListing","docRef","listingId","docSnap","exists","data","location","user","current","onSubmit","e","preventDefault","length","geolocation","REACT_APP_GEOCODE_API_KEY","fetch","response","json","lat","results","geometry","lng","status","undefined","formatted_address","includes","storeImage","image","Promise","resolve","reject","storage","fileName","storageRef","uploadTask","on","snapshot","progress","bytesTransferred","totalBytes","console","log","state","then","downloadURL","all","map","catch","imgUrls","formDataCopy","timestamp","success","id","onMutate","boolean","target","value","files","prevState"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef } from 'react'\nimport { getAuth, onAuthStateChanged } from 'firebase/auth'\nimport {\n  getStorage,\n  ref,\n  uploadBytesResumable,\n  getDownloadURL,\n} from 'firebase/storage'\nimport { doc, updateDoc, getDoc, serverTimestamp } from 'firebase/firestore'\nimport { db } from '../firebase.config'\nimport { useNavigate, useParams } from 'react-router-dom'\nimport { toast } from 'react-toastify'\nimport { v4 as uuidv4 } from 'uuid'\nimport Spinner from '../components/Spinner'\n\nfunction EditListing() {\n  // eslint-disable-next-line\n  const [geolocationEnabled, setGeolocationEnabled] = useState(true)\n  const [loading, setLoading] = useState(false)\n  const [listing, setListing] = useState(false)\n  const [formData, setFormData] = useState({\n    type: 'rent',\n    name: '',\n    description:'',\n    address: '',\n    offer: false,\n    regularPrice: 0,\n    discountedPrice: 0,\n    images: {},\n    latitude: 0,\n    longitude: 0,\n  })\n\n  const {\n    type,\n    name,\n    description,\n    address,\n    offer,\n    regularPrice,\n    discountedPrice,\n    images,\n    latitude,\n    longitude,\n  } = formData\n\n  const auth = getAuth()\n  const navigate = useNavigate()\n  const params = useParams()\n  const isMounted = useRef(true)\n\n  // Redirect if listing is not user's\n  useEffect(() => {\n    if (listing && listing.userRef !== auth.currentUser.uid) {\n      toast.error('You can not edit that listing')\n      navigate('/')\n    }\n  })\n\n  // Fetch listing to edit\n  useEffect(() => {\n    setLoading(true)\n    const fetchListing = async () => {\n      const docRef = doc(db, 'listings', params.listingId)\n      const docSnap = await getDoc(docRef)\n      if (docSnap.exists()) {\n        setListing(docSnap.data())\n        setFormData({ ...docSnap.data(), address: docSnap.data().location })\n        setLoading(false)\n      } else {\n        navigate('/')\n        toast.error('Listing does not exist')\n      }\n    }\n\n    fetchListing()\n  }, [params.listingId, navigate])\n\n  // Sets userRef to logged in user\n  useEffect(() => {\n    if (isMounted) {\n      onAuthStateChanged(auth, (user) => {\n        if (user) {\n          setFormData({ ...formData, userRef: user.uid })\n        } else {\n          navigate('/sign-in')\n        }\n      })\n    }\n\n    return () => {\n      isMounted.current = false\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isMounted])\n\n  const onSubmit = async (e) => {\n    e.preventDefault()\n\n    setLoading(true)\n\n    if (discountedPrice >= regularPrice) {\n      setLoading(false)\n      toast.error('Discounted price needs to be less than regular price')\n      return\n    }\n\n    if (images.length > 6) {\n      setLoading(false)\n      toast.error('Max 6 images')\n      return\n    }\n\n    let geolocation = {}\n    let location\n    let REACT_APP_GEOCODE_API_KEY='AIzaSyC_mnmV8bSDh0YhMMQMBHLKS667q4S86hw'\n    if (geolocationEnabled) {\n      const response = await fetch(\n        `https://maps.googleapis.com/maps/api/geocode/json?address=${address}&key=${REACT_APP_GEOCODE_API_KEY}`\n      )\n\n      const data = await response.json()\n\n      geolocation.lat = data.results[0]?.geometry.location.lat ?? 0\n      geolocation.lng = data.results[0]?.geometry.location.lng ?? 0\n\n      location =\n        data.status === 'ZERO_RESULTS'\n          ? undefined\n          : data.results[0]?.formatted_address\n\n      if (location === undefined || location.includes('undefined')) {\n        setLoading(false)\n        toast.error('Please enter a correct address')\n        return\n      }\n    } else {\n      geolocation.lat = latitude\n      geolocation.lng = longitude\n    }\n\n    // Store image in firebase\n    const storeImage = async (image) => {\n      return new Promise((resolve, reject) => {\n        const storage = getStorage()\n        const fileName = `${auth.currentUser.uid}-${image.name}-${uuidv4()}`\n\n        const storageRef = ref(storage, 'images/' + fileName)\n\n        const uploadTask = uploadBytesResumable(storageRef, image)\n\n        uploadTask.on(\n          'state_changed',\n          (snapshot) => {\n            const progress =\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n            console.log('Upload is ' + progress + '% done')\n            switch (snapshot.state) {\n              case 'paused':\n                console.log('Upload is paused')\n                break\n              case 'running':\n                console.log('Upload is running')\n                break\n              default:\n                break\n            }\n          },\n          (error) => {\n            reject(error)\n          },\n          () => {\n            // Handle successful uploads on complete\n            // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n            getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\n              resolve(downloadURL)\n            })\n          }\n        )\n      })\n    }\n\n    const imgUrls = await Promise.all(\n      [...images].map((image) => storeImage(image))\n    ).catch(() => {\n      setLoading(false)\n      toast.error('Images not uploaded')\n      return\n    })\n\n    const formDataCopy = {\n      ...formData,\n      imgUrls,\n      geolocation,\n      timestamp: serverTimestamp(),\n    }\n\n    formDataCopy.location = address\n    delete formDataCopy.images\n    delete formDataCopy.address\n    !formDataCopy.offer && delete formDataCopy.discountedPrice\n\n    // Update listing\n    const docRef = doc(db, 'listings', params.listingId)\n    await updateDoc(docRef, formDataCopy)\n    setLoading(false)\n    toast.success('Listing saved')\n    navigate(`/category/${formDataCopy.type}/${docRef.id}`)\n  }\n\n  const onMutate = (e) => {\n    let boolean = null\n\n    if (e.target.value === 'true') {\n      boolean = true\n    }\n    if (e.target.value === 'false') {\n      boolean = false\n    }\n\n    // Files\n    if (e.target.files) {\n      setFormData((prevState) => ({\n        ...prevState,\n        images: e.target.files,\n      }))\n    }\n\n    // Text/Booleans/Numbers\n    if (!e.target.files) {\n      setFormData((prevState) => ({\n        ...prevState,\n        [e.target.id]: boolean ?? e.target.value,\n      }))\n    }\n  }\n\n  if (loading) {\n    return <Spinner />\n  }\n\n  return (\n    <div className='profile'>\n      <header>\n        <p className='pageHeader'>Edit Listing</p>\n      </header>\n\n      <main>\n        <form onSubmit={onSubmit}>\n          <label className='formLabel'>Sell / Rent</label>\n          <div className='formButtons'>\n            <button\n              type='button'\n              className={type === 'sale' ? 'formButtonActive' : 'formButton'}\n              id='type'\n              value='sale'\n              onClick={onMutate}\n            >\n              Sell\n            </button>\n            <button\n              type='button'\n              className={type === 'rent' ? 'formButtonActive' : 'formButton'}\n              id='type'\n              value='rent'\n              onClick={onMutate}\n            >\n              Rent\n            </button>\n          </div>\n\n          <label className='formLabel'>Name</label>\n          <input\n            className='formInputName'\n            type='text'\n            id='name'\n            value={name}\n            onChange={onMutate}\n            maxLength='32'\n            minLength='10'\n            required\n          />\n          <label className='formLabel'>Description</label>\n          <input\n            className='formInputName'\n            type='text'\n            id='description'\n            value={description}\n            onChange={onMutate}\n            maxLength='32'\n            minLength='10'\n            required\n          />\n\n          <label className='formLabel'>Address</label>\n          <textarea\n            className='formInputAddress'\n            type='text'\n            id='address'\n            value={address}\n            onChange={onMutate}\n            required\n          />\n\n          {!geolocationEnabled && (\n            <div className='formLatLng flex'>\n              <div>\n                <label className='formLabel'>Latitude</label>\n                <input\n                  className='formInputSmall'\n                  type='number'\n                  id='latitude'\n                  value={latitude}\n                  onChange={onMutate}\n                  required\n                />\n              </div>\n              <div>\n                <label className='formLabel'>Longitude</label>\n                <input\n                  className='formInputSmall'\n                  type='number'\n                  id='longitude'\n                  value={longitude}\n                  onChange={onMutate}\n                  required\n                />\n              </div>\n            </div>\n          )}\n\n          <label className='formLabel'>Offer</label>\n          <div className='formButtons'>\n            <button\n              className={offer ? 'formButtonActive' : 'formButton'}\n              type='button'\n              id='offer'\n              value={true}\n              onClick={onMutate}\n            >\n              Yes\n            </button>\n            <button\n              className={\n                !offer && offer !== null ? 'formButtonActive' : 'formButton'\n              }\n              type='button'\n              id='offer'\n              value={false}\n              onClick={onMutate}\n            >\n              No\n            </button>\n          </div>\n\n          <label className='formLabel'>Regular Price</label>\n          <div className='formPriceDiv'>\n            <input\n              className='formInputSmall'\n              type='number'\n              id='regularPrice'\n              value={regularPrice}\n              onChange={onMutate}\n              min='50'\n              max='750000000'\n              required\n            />\n            {type === 'rent' && <p className='formPriceText'>$ / Month</p>}\n          </div>\n\n          {offer && (\n            <>\n              <label className='formLabel'>Discounted Price</label>\n              <input\n                className='formInputSmall'\n                type='number'\n                id='discountedPrice'\n                value={discountedPrice}\n                onChange={onMutate}\n                min='50'\n                max='750000000'\n                required={offer}\n              />\n            </>\n          )}\n\n          <label className='formLabel'>Images</label>\n          <p className='imagesInfo'>\n            The first image will be the cover (max 6).\n          </p>\n          <input\n            className='formInputFile'\n            type='file'\n            id='images'\n            onChange={onMutate}\n            max='6'\n            accept='.jpg,.png,.jpeg'\n            multiple\n            required\n          />\n          <button type='submit' className='primaryButton createListingButton'>\n            Edit Listing\n          </button>\n        </form>\n      </main>\n    </div>\n  )\n}\n\nexport default EditListing\n"]},"metadata":{},"sourceType":"module"}